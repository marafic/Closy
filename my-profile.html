<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Closy â€” My Profile</title>
    <link rel="stylesheet" href="styles/styles.css" />
  </head>
  <body>
    <div class="page">
    <header class="top">
      <div class="logo-wrap">
      <div id="site-header"></div>
      </div>
        <nav class="tabs">
          <a class="tab" href="overview.html">Overview</a>
          <a class="tab" href="my-closet.html">My Closet</a>
          <a class="tab" href="planner.html">Planner</a>
          <a class="tab" href="outfits.html">Outfits</a>
          <a class="tab active" href="feed.html">Feed</a>
        </nav>
      </header>
    <script src="header.js"></script>

      <main class="container">
        <div class="feed-tabs">
          <a class="feed-tab" href="feed.html">All Posts</a>
          <a class="feed-tab" href="feed-following.html">Following</a>
          <a class="feed-tab" href="feed-friends.html">Friends</a>
          <a class="feed-tab active" href="my-profile.html">My Profile</a>
        </div>

        <div class="panel" style="margin-bottom:24px;padding:32px;display:flex;flex-direction:column;align-items:center;">
          <div class="avatar" style="width:120px;height:120px;margin-bottom:20px;">
            <img src="https://i.pravatar.cc/120?img=20" alt="My profile avatar" />
          </div>
          
          <h2 style="margin:0 0 4px 0;font-size:24px;">Mara</h2>
          <div style="color:#7b7b95;font-size:15px;margin-bottom:24px;">mara.nlx</div>

          <div style="display:flex;gap:40px;text-align:center;">
            <div>
              <div style="font-size:18px;font-weight:700;color:#111;" id="posts-count">0</div>
              <div style="color:#7b7b95;font-size:14px;">Posts</div>
            </div>
            <div>
              <div style="font-size:18px;font-weight:700;color:#111;" id="followers-count">3</div>
              <div style="color:#7b7b95;font-size:14px;">Followers</div>
            </div>
            <div>
              <div style="font-size:18px;font-weight:700;color:#111;" id="following-count">0</div>
              <div style="color:#7b7b95;font-size:14px;">Following</div>
            </div>
          </div>
        </div>

        <h3 style="margin-bottom:16px;">My Posts</h3>
        <section class="empty-closet" id="empty-posts" style="display:none;">
          <p class="empty-text">You haven't created any posts yet.</p>
          <p class="panel-sub">Share your outfits with the community!</p>
        </section>
        
        <div id="my-posts-container"></div>
      </main>

      <button class="floating-add-btn" onclick="window.location.href='create-post.html'" aria-label="Add new post" title="Add new post">+</button>

      <div id="delete-modal" class="modal-overlay" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:9999;align-items:center;justify-content:center;padding:16px;">
        <div class="modal-content" style="background:#fff;padding:32px;border-radius:16px;max-width:400px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,0.3);">
          <h3 style="margin:0 0 12px 0;font-size:20px;color:#111;">Delete Post?</h3>
          <p style="margin:0 0 24px 0;color:#666;font-size:15px;">Are you sure you want to delete this post? This action cannot be undone.</p>
          <div style="display:flex;gap:12px;justify-content:flex-end;flex-wrap:wrap;">
            <button id="cancel-delete" class="btn" onclick="window.hideDeleteModal()" style="background:#f3f3f6;color:#333;padding:10px 20px;border-radius:10px;border:none;cursor:pointer;font-weight:500;">Cancel</button>
            <button id="confirm-delete" class="btn" onclick="window.confirmDelete()" style="background:#ff4444;color:#fff;padding:10px 20px;border-radius:10px;border:none;cursor:pointer;font-weight:500;">Delete</button>
          </div>
        </div>
      </div>

      <script>
        // Global delete functions
        window.currentPostId = null;
        
        window.showDeleteModal = function(postId) {
          console.log('showDeleteModal called with:', postId);
          window.currentPostId = postId;
          var modal = document.getElementById('delete-modal');
          if (modal) modal.style.display = 'flex';
        };
        
        window.hideDeleteModal = function() {
          console.log('hideDeleteModal called');
          var modal = document.getElementById('delete-modal');
          if (modal) modal.style.display = 'none';
          window.currentPostId = null;
        };
        
        window.confirmDelete = function() {
          console.log('confirmDelete called for post:', window.currentPostId);
          if (!window.currentPostId) {
            alert('No post selected');
            return;
          }
          
          try {
            var posts = JSON.parse(localStorage.getItem('closy-user-posts-v1') || '[]');
            console.log('Posts before:', posts.length);
            var newPosts = posts.filter(function(p) { 
              return p.id !== window.currentPostId; 
            });
            console.log('Posts after:', newPosts.length);
            
            if (newPosts.length === posts.length) {
              alert('Post not found');
              return;
            }
            
            localStorage.setItem('closy-user-posts-v1', JSON.stringify(newPosts));
            console.log('Post deleted, reloading...');
            window.hideDeleteModal();
            location.reload();
          } catch (e) {
            console.error('Delete error:', e);
            alert('Error: ' + e.message);
          }
        };
        
        document.addEventListener('DOMContentLoaded', function() {
          console.log('Page loaded');
          
          try {
            var following = localStorage.getItem('closy-following-v1');
            var count = following ? Object.keys(JSON.parse(following)).length : 0;
            document.getElementById('following-count').textContent = count;
          } catch (e) {
            console.error('Following error:', e);
          }

          try {
            var rawPosts = localStorage.getItem('closy-user-posts-v1');
            var posts = rawPosts ? JSON.parse(rawPosts) : [];
            console.log('Loaded', posts.length, 'posts');
            
            var container = document.getElementById('my-posts-container');
            var empty = document.getElementById('empty-posts');
            var countEl = document.getElementById('posts-count');
            
            if (countEl) countEl.textContent = posts.length;
            
            if (posts.length === 0) {
              empty.style.display = '';
              return;
            }
            
            empty.style.display = 'none';
            
            posts.forEach(function(post) {
              var itemsHtml = '';
              if (post.items && post.items.length > 0) {
                itemsHtml = post.items.map(function(item) {
                  return '<div class="post-item"><img src="' + item.image + '" alt="' + item.name + '"><div class="post-item-label">' + item.name + '</div></div>';
                }).join('');
              }
              
              var html = '<article class="post-card">' +
                '<header class="post-header"><div class="post-author"><div class="avatar"><img src="' + post.avatar + '" alt="' + post.author + '"></div><div class="author-meta"><div class="author-name">' + post.author + '</div><div class="post-date">' + post.username + '</div></div></div></header>' +
                '<div class="post-main"><div class="post-thumb"><img src="' + post.image + '" alt="outfit"></div><div class="post-items-section"><div class="post-items-header">Items in this outfit</div><div class="post-items-grid">' + itemsHtml + '</div></div></div>' +
                '<div class="post-text"><h4 class="post-title">' + post.title + '</h4><p class="post-desc">' + post.description + '</p><hr class="post-sep"><div class="post-actions">' +
                '<button class="action like" data-post-id="' + post.id + '"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z" stroke="#111" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg><span class="count">' + post.likes + '</span></button>' +
                '<button class="action delete-post" onclick="window.showDeleteModal(\'' + post.id + '\')" style="margin-left:auto;background:#f3f3f6;color:#333;padding:10px 16px;border-radius:10px;font-weight:500;cursor:pointer;border:none;"><span>Delete</span></button>' +
                '</div></div></article>';
              
              container.insertAdjacentHTML('beforeend', html);
            });
          } catch (e) {
            console.error('Posts error:', e);
          }
        });
      </script>

    </div>
  </body>
</html>

